(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{TextGeometry:()=>z,computeBox:()=>T,computeSphere:()=>C,createBasicShader:()=>R,createMSDFShader:()=>X,createMultipageShader:()=>Y,createSDFShader:()=>q,createTextGeometry:()=>I,pages:()=>P,positions:()=>U,uvs:()=>k});var r=/\n/,n="\n",i=/\s/;function o(t,e){if(0===(e=e||{}).width&&"nowrap"!==e.mode)return[];t=t||"";var i="number"==typeof e.width?e.width:Number.MAX_VALUE,o=Math.max(0,e.start||0),l="number"==typeof e.end?e.end:t.length,s=e.mode,f=e.measure||c;return"pre"===s?function(t,e,n,i,o){for(var a=[],u=n,c=n;c<i&&c<e.length;c++){var l=e.charAt(c),s=r.test(l);if(s||c===i-1){var f=t(e,u,s?c:c+1,o);a.push(f),u=c+1}}return a}(f,t,o,l,i):function(t,e,r,i,o,c){var l=[],s=o;"nowrap"===c&&(s=Number.MAX_VALUE);for(;r<i&&r<e.length;){for(var f=a(e,n,r,i);r<f&&u(e.charAt(r));)r++;var p=t(e,r,f,s),h=r+(p.end-p.start),v=h+1;if(h<f){for(;h>r&&!u(e.charAt(h));)h--;if(h===r)v>r+1&&v--,h=v;else for(v=h;h>r&&u(e.charAt(h-1));)h--}if(h>=r){var m=t(e,r,h,s);l.push(m)}r=v}return l}(f,t,o,l,i,s)}function a(t,e,r,n){var i=t.indexOf(e,r);return-1===i||i>n?n:i}function u(t){return i.test(t)}function c(t,e,r,n){return{start:e,end:e+Math.min(n,r-e)}}function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,f(n.key),n)}}function f(t){var e=function(t,e){if("object"!=l(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==l(e)?e:e+""}var p=["x","e","a","o","n","s","r","c","u","m","v","w","z"],h=["m","w"],v=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],m="\t".charCodeAt(0),y=" ".charCodeAt(0);function d(t,e){return"number"==typeof t?t:"number"==typeof e?e:0}var g=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach((function(e){Object.defineProperty(t,e,{get:b(e),configurable:!0})})),this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(e)},(e=[{key:"update",value:function(t){var e=this;if(t=Object.assign({measure:this._measure},t),this._opt=t,this._opt.tabSize=d(this._opt.tabSize,4),!t.font)throw new Error("must provide a valid bitmap font");var r=this.glyphs,n=t.text||"",i=t.font;this._setupSpaceGlyphs(i);var a=o(n,t),u=t.width||0;r.length=0;var c=a.reduce((function(t,e){return Math.max(t,e.width,u)}),0),l=0,s=0,f=d(t.lineHeight,i.common.lineHeight),h=i.common.base,m=f-h,y=t.letterSpacing||0,g=f*a.length-m,b=function(t){return"center"===t?1:"right"===t?2:0}(this._opt.align);s-=g,this._width=c,this._height=g,this._descender=f-h,this._baseline=h,this._xHeight=function(t){for(var e=0;e<p.length;e++){var r=p[e].charCodeAt(0),n=_(t.chars,r);if(n>=0)return t.chars[n].height}return 0}(i),this._capHeight=function(t){for(var e=0;e<v.length;e++){var r=v[e].charCodeAt(0),n=_(t.chars,r);if(n>=0)return t.chars[n].height}return 0}(i),this._lineHeight=f,this._ascender=f-m-this._xHeight,a.forEach((function(t,o){for(var a,u=t.start,p=t.end,h=t.width,v=u;v<p;v++){var m=n.charCodeAt(v),d=e.getGlyph(i,m);if(d){a&&(l+=w(i,a.id,d.id));var g=l;1===b?g+=(c-h)/2:2===b&&(g+=c-h),r.push({position:[g,s],data:d,index:v,line:o}),l+=d.xadvance+y,a=d}}s+=f,l=0})),this._linesTotal=a.length}},{key:"_setupSpaceGlyphs",value:function(t){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,t.chars&&0!==t.chars.length){var e=x(t,y)||function(t){for(var e=0;e<h.length;e++){var r=h[e].charCodeAt(0),n=_(t.chars,r);if(n>=0)return t.chars[n]}return 0}(t)||t.chars[0],r=(e=JSON.parse(JSON.stringify(e)),this._opt.tabSize*e.xadvance);this._fallbackSpaceGlyph=e,this._fallbackTabGlyph=Object.assign(e,{x:0,y:0,xadvance:r,id:m,xoffset:0,yoffset:0,width:0,height:0})}}},{key:"getGlyph",value:function(t,e){var r=x(t,e);return r||(e===m?this._fallbackTabGlyph:e===y?this._fallbackSpaceGlyph:null)}},{key:"computeMetrics",value:function(t,e,r,n){var i,o=this._opt.letterSpacing||0,a=this._opt.font,u=0,c=0,l=0;if(!a.chars||0===a.chars.length)return{start:e,end:e,width:0};r=Math.min(t.length,r);for(var s=e;s<r;s++){var f,p=t.charCodeAt(s);if(f=this.getGlyph(a,p)){f.xoffset;var h=(u+=i?w(a,i.id,f.id):0)+f.xadvance+o,v=u+f.width;if(v>=n||h>=n)break;u=h,c=v,i=f}l++}return i&&(c+=i.xoffset),{start:e,end:e+l,width:c}}}])&&s(t.prototype,e),r&&s(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r}();function b(t){return new Function(["return function "+t+"() {","  return this._"+t,"}"].join("\n"))()}function x(t,e){if(!t.chars||0===t.chars.length)return null;var r=_(t.chars,e);return r>=0?t.chars[r]:null}function w(t,e,r){if(!t.kernings||0===t.kernings.length)return 0;for(var n=t.kernings,i=0;i<n.length;i++){var o=n[i];if(o.first===e&&o.second===r)return o.amount}return 0}function _(t,e,r){for(var n=r=r||0;n<t.length;n++)if(t[n].id===e)return n;return-1}var S=[0,2,3],j=[2,1,3];function O(t,e){var r,n,i;t&&(n=t,i=Object.prototype.toString,n.BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===i.call(n.buffer)||Array.isArray(n)||null!=(r=t)&&null!=r.constructor&&"function"==typeof r.constructor.isBuffer&&r.constructor.isBuffer(r))||(e=t||{},t=null);for(var o="string"==typeof(e="number"==typeof e?{count:e}:e||{}).type?e.type:"uint16",a="number"==typeof e.count?e.count:1,u=e.start||0,c=!1!==e.clockwise?S:j,l=c[0],s=c[1],f=c[2],p=6*a,h=t||new(function(t){switch(t){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}(o))(p),v=0,m=0;v<p;v+=6,m+=4){var y=v+u;h[y+0]=m+0,h[y+1]=m+1,h[y+2]=m+2,h[y+3]=m+l,h[y+4]=m+s,h[y+5]=m+f}return h}var A=3,M={min:[0,0,0],max:[0,0,0]};function E(t){var e=t.length/A;M.min[0]=t[0],M.min[1]=t[1],M.min[2]=t[2],M.max[0]=t[0],M.max[1]=t[1],M.max[2]=t[2];for(var r=0;r<e;r++){var n=t[r*A+0],i=t[r*A+1],o=t[r*A+2];M.min[0]=Math.min(n,M.min[0]),M.min[1]=Math.min(i,M.min[1]),M.min[2]=Math.min(o,M.min[2]),M.max[0]=Math.max(n,M.max[0]),M.max[1]=Math.max(i,M.max[1]),M.max[2]=Math.max(o,M.max[2])}}function T(t,e){E(t),e.min.set(M.min[0],M.min[1],M.min[2]),e.max.set(M.max[0],M.max[1],M.max[2])}function C(t,e){E(t);var r=M.min[0],n=M.min[1],i=M.min[2],o=M.max[0]-r,a=M.max[1]-n,u=M.max[2]-i,c=Math.sqrt(o*o+a*a);e.center.set(r+o/2,n+a/2,i+u/2),e.radius=c/2}function P(t){var e=new Float32Array(4*t.length*1),r=0;return t.forEach((function(t){var n=t.data.page||0;e[r++]=n,e[r++]=n,e[r++]=n,e[r++]=n})),e}function k(t,e,r,n){var i=new Float32Array(4*t.length*2),o=0;return t.forEach((function(t){var a=t.data,u=a.x+a.width,c=a.y+a.height,l=a.x/e,s=a.y/r,f=u/e,p=c/r;n&&(s=(r-a.y)/r,p=(r-c)/r),i[o++]=l,i[o++]=s,i[o++]=l,i[o++]=p,i[o++]=f,i[o++]=p,i[o++]=f,i[o++]=s})),i}function U(t){var e=new Float32Array(4*t.length*3),r=0;return t.forEach((function(t){var n=t.data,i=t.position[0]+n.xoffset,o=t.position[1]+n.yoffset,a=n.width,u=n.height;e[r++]=i,e[r++]=o,e[r++]=0,e[r++]=i,e[r++]=o+u,e[r++]=0,e[r++]=i+a,e[r++]=o+u,e[r++]=0,e[r++]=i+a,e[r++]=o,e[r++]=0})),e}const B=require("three");function G(t){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},G(t)}function F(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,N(n.key),n)}}function N(t){var e=function(t,e){if("object"!=G(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=G(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==G(e)?e:e+""}function D(t,e,r){return e=H(e),function(t,e){if(e&&("object"==G(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,V()?Reflect.construct(e,r||[],H(t).constructor):e.apply(t,r))}function V(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(V=function(){return!!t})()}function H(t){return H=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},H(t)}function L(t,e){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},L(t,e)}function I(t){return new z(t)}var z=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),"string"==typeof t&&(t={text:t}),(r=D(this,e))._opt=Object.assign({},t),t&&r.update(t),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&L(t,e)}(e,t),r=e,n=[{key:"update",value:function(t){if("string"==typeof t&&(t={text:t}),!(t=Object.assign({},this._opt,t)).font)throw new TypeError("must specify a { font } in options");this.layout=function(t){return new g(t)}(t);var e=!1!==t.flipY,r=t.font,n=r.common.scaleW,i=r.common.scaleH,o=this.layout.glyphs.filter((function(t){var e=t.data;return e.width*e.height>0}));this.visibleGlyphs=o;var a=U(o),u=k(o,n,i,e),c=O([],{clockwise:!0,type:"uint16",count:o.length});if(this.setIndex(c),this.setAttribute("position",new B.BufferAttribute(a,3)),this.setAttribute("uv",new B.BufferAttribute(u,2)),!t.multipage&&"page"in this.attributes)this.removeAttribute("page");else if(t.multipage){var l=P(o);this.setAttribute("page",new B.BufferAttribute(l,1))}}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new B.Sphere);var t=this.attributes.position.array,e=this.attributes.position.itemSize;if(!t||!e||t.length<3)return this.boundingSphere.radius=0,void this.boundingSphere.center.set(0,0,0);C(t,this.boundingSphere),isNaN(this.boundingSphere.radius)&&console.error('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new B.Box3);var t=this.boundingBox,e=this.attributes.position.array,r=this.attributes.position.itemSize;!e||!r||e.length<3?t.makeEmpty():T(e,t)}}],n&&F(r.prototype,n),i&&F(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,i}(B.BufferGeometry);function R(t){var e="number"==typeof(t=t||{}).opacity?t.opacity:1,r="number"==typeof t.alphaTest?t.alphaTest:1e-4,n=t.precision||"highp",i=t.color,o=t.map;return delete t.map,delete t.color,delete t.precision,delete t.opacity,Object.assign({uniforms:{opacity:{type:"f",value:e},map:{type:"t",value:o||new B.Texture},color:{type:"c",value:new B.Color(i)}},vertexShader:["attribute vec2 uv;","attribute vec4 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * position;","}"].join("\n"),fragmentShader:["precision "+n+" float;","uniform float opacity;","uniform vec3 color;","uniform sampler2D map;","varying vec2 vUv;","void main() {","  gl_FragColor = texture2D(map, vUv) * vec4(color, opacity);",0===r?"":"  if (gl_FragColor.a < "+r+") discard;","}"].join("\n")},t)}function X(t){var e="number"==typeof(t=t||{}).opacity?t.opacity:1,r="number"==typeof t.alphaTest?t.alphaTest:1e-4,n=t.precision||"highp",i=t.color,o=t.map,a="boolean"!=typeof t.negate||t.negate;return delete t.map,delete t.color,delete t.precision,delete t.opacity,delete t.negate,Object.assign({uniforms:{opacity:{type:"f",value:e},map:{type:"t",value:o||new B.Texture},color:{type:"c",value:new B.Color(i)}},vertexShader:["attribute vec2 uv;","attribute vec4 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * position;","}"].join("\n"),fragmentShader:["#ifdef GL_OES_standard_derivatives","#extension GL_OES_standard_derivatives : enable","#endif","precision "+n+" float;","uniform float opacity;","uniform vec3 color;","uniform sampler2D map;","varying vec2 vUv;","float median(float r, float g, float b) {","  return max(min(r, g), min(max(r, g), b));","}","void main() {","  vec3 sample = "+(a?"1.0 - ":"")+"texture2D(map, vUv).rgb;","  float sigDist = median(sample.r, sample.g, sample.b) - 0.5;","  float alpha = clamp(sigDist/fwidth(sigDist) + 0.5, 0.0, 1.0);","  gl_FragColor = vec4(color.xyz, alpha * opacity);",0===r?"":"  if (gl_FragColor.a < "+r+") discard;","}"].join("\n")},t)}function Y(t){var e="number"==typeof(t=t||{}).opacity?t.opacity:1,r=t.precision||"highp",n="number"==typeof t.alphaTest?t.alphaTest:1e-4,i=t.textures||[];i=Array.isArray(i)?i:[i];var o={};i.forEach((function(t,e){o["texture"+e]={type:"t",value:t}}));var a=i.map((function(t,e){return"uniform sampler2D texture"+e+";"})).join("\n"),u=i.map((function(t,e){return[(0===e?"if":"else if")+" (vPage == "+e+".0) {","sampleColor = texture2D(texture"+e+", vUv);","}"].join("\n")})).join("\n"),c=t.color;delete t.textures,delete t.color,delete t.precision,delete t.opacity;var l={attributes:{page:{type:"f",value:0}}};return(0|(parseInt(B.REVISION,10)||0))>=72&&(l=void 0),Object.assign({uniforms:Object.assign({},o,{opacity:{type:"f",value:e},color:{type:"c",value:new B.Color(c)}}),vertexShader:["attribute vec4 position;","attribute vec2 uv;","attribute float page;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUv;","varying float vPage;","void main() {","vUv = uv;","vPage = page;","gl_Position = projectionMatrix * modelViewMatrix * position;","}"].join("\n"),fragmentShader:["precision "+r+" float;","uniform float opacity;","uniform vec3 color;",a,"varying float vPage;","varying vec2 vUv;","void main() {","vec4 sampleColor = vec4(0.0);",u,"gl_FragColor = sampleColor * vec4(color, opacity);",0===n?"":"  if (gl_FragColor.a < "+n+") discard;","}"].join("\n")},l,t)}function q(t){var e="number"==typeof(t=t||{}).opacity?t.opacity:1,r="number"==typeof t.alphaTest?t.alphaTest:1e-4,n=t.precision||"highp",i=t.color,o=t.map;return delete t.map,delete t.color,delete t.precision,delete t.opacity,Object.assign({uniforms:{opacity:{type:"f",value:e},map:{type:"t",value:o||new B.Texture},color:{type:"c",value:new B.Color(i)}},vertexShader:["attribute vec2 uv;","attribute vec4 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * position;","}"].join("\n"),fragmentShader:["#ifdef GL_OES_standard_derivatives","#extension GL_OES_standard_derivatives : enable","#endif","precision "+n+" float;","uniform float opacity;","uniform vec3 color;","uniform sampler2D map;","varying vec2 vUv;","float aastep(float value) {","  #ifdef GL_OES_standard_derivatives","    float afwidth = length(vec2(dFdx(value), dFdy(value))) * 0.70710678118654757;","  #else","    float afwidth = (1.0 / 32.0) * (1.4142135623730951 / (2.0 * gl_FragCoord.w));","  #endif","  return smoothstep(0.5 - afwidth, 0.5 + afwidth, value);","}","void main() {","  vec4 texColor = texture2D(map, vUv);","  float alpha = aastep(texColor.a);","  gl_FragColor = vec4(color, opacity * alpha);",0===r?"":"  if (gl_FragColor.a < "+r+") discard;","}"].join("\n")},t)}var J=exports;for(var W in e)J[W]=e[W];e.__esModule&&Object.defineProperty(J,"__esModule",{value:!0})})();